# 05. Aurora（MySQL）接続設定

このドキュメントでは、Spring Boot アプリケーションから AWS Aurora（MySQL 互換）に接続するための手順と設定をまとめます。

---

## 🧱 構成概要

| 項目 | 内容 |
|------|------|
| DB種類 | Amazon Aurora (MySQL 互換) |
| バージョン例 | Aurora MySQL 5.7 / 8.0 |
| 接続方式 | JDBC（application.properties/yml） |
| ドライバ | `mysql-connector-j` |

---

## 🛠 Aurora 構築（Terraform例）

```hcl
resource "aws_rds_cluster" "aurora_cluster" {
  cluster_identifier = "sample-aurora-cluster"
  engine             = "aurora-mysql"
  engine_mode        = "provisioned"
  master_username    = "admin"
  master_password    = "your-secure-password"
  backup_retention_period = 5
  skip_final_snapshot     = true
}

resource "aws_rds_cluster_instance" "aurora_instance" {
  count              = 2
  identifier         = "aurora-instance-${count.index}"
  cluster_identifier = aws_rds_cluster.aurora_cluster.id
  instance_class     = "db.t3.medium"
  engine             = aws_rds_cluster.aurora_cluster.engine
}
```

---

## 🔗 Spring Boot 側の接続設定

`application.properties` または `application.yml` に以下を追加：

```properties
spring.datasource.url=jdbc:mysql://{Auroraのエンドポイント}:3306/{データベース名}
spring.datasource.username=admin
spring.datasource.password=your-secure-password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
```

---

## 📦 依存関係の追加（pom.xml）

```xml
<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-j</artifactId>
</dependency>
```

---

## 🔒 セキュリティ構成の注意

- Aurora の **セキュリティグループ** に、アプリケーション（EC2/Beanstalk）の **インバウンドアクセス許可** を設定する。
- VPC 内で接続を行う構成とする。

---

## 🧪 動作確認方法

1. Aurora エンドポイントを確認（AWSコンソール）
2. Spring Boot アプリを起動
3. 接続ログ or エラーが出力されるか確認
4. 初回はテーブル作成されるか確認（`spring.jpa.hibernate.ddl-auto=update`）

---

## 🚨 よくある接続エラー

| エラー内容 | 原因と対策 |
|------------|------------|
| Timeout | SG でポート 3306 が開いていない／VPCが違う |
| Access Denied | ユーザー名 or パスワード間違い |
| Unknown database | JDBC URL のデータベース名が未作成 |

---

## 🔗 参考リンク

- [Amazon Aurora（MySQL）公式](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/)
- [Spring Boot + MySQL 接続](https://spring.io/guides/gs/accessing-data-mysql/)

