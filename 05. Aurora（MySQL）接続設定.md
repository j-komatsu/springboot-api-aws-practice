# 05. Auroraï¼ˆMySQLï¼‰æ¥ç¶šè¨­å®š

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Spring Boot ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ AWS Auroraï¼ˆMySQL äº’æ›ï¼‰ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®æ‰‹é †ã¨è¨­å®šã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

## ğŸ§± æ§‹æˆæ¦‚è¦

| é …ç›® | å†…å®¹ |
|------|------|
| DBç¨®é¡ | Amazon Aurora (MySQL äº’æ›) |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¾‹ | Aurora MySQL 5.7 / 8.0 |
| æ¥ç¶šæ–¹å¼ | JDBCï¼ˆapplication.properties/ymlï¼‰ |
| ãƒ‰ãƒ©ã‚¤ãƒ | `mysql-connector-j` |

---

## ğŸ›  Aurora æ§‹ç¯‰ï¼ˆTerraformä¾‹ï¼‰

```hcl
resource "aws_rds_cluster" "aurora_cluster" {
  cluster_identifier = "sample-aurora-cluster"
  engine             = "aurora-mysql"
  engine_mode        = "provisioned"
  master_username    = "admin"
  master_password    = "your-secure-password"
  backup_retention_period = 5
  skip_final_snapshot     = true
}

resource "aws_rds_cluster_instance" "aurora_instance" {
  count              = 2
  identifier         = "aurora-instance-${count.index}"
  cluster_identifier = aws_rds_cluster.aurora_cluster.id
  instance_class     = "db.t3.medium"
  engine             = aws_rds_cluster.aurora_cluster.engine
}
```

---

## ğŸ”— Spring Boot å´ã®æ¥ç¶šè¨­å®š

`application.properties` ã¾ãŸã¯ `application.yml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```properties
spring.datasource.url=jdbc:mysql://{Auroraã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ}:3306/{ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å}
spring.datasource.username=admin
spring.datasource.password=your-secure-password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
```

---

## ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®è¿½åŠ ï¼ˆpom.xmlï¼‰

```xml
<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-j</artifactId>
</dependency>
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ§‹æˆã®æ³¨æ„

- Aurora ã® **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—** ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆEC2/Beanstalkï¼‰ã® **ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯** ã‚’è¨­å®šã™ã‚‹ã€‚
- VPC å†…ã§æ¥ç¶šã‚’è¡Œã†æ§‹æˆã¨ã™ã‚‹ã€‚

---

## ğŸ§ª å‹•ä½œç¢ºèªæ–¹æ³•

1. Aurora ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèªï¼ˆAWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰
2. Spring Boot ã‚¢ãƒ—ãƒªã‚’èµ·å‹•
3. æ¥ç¶šãƒ­ã‚° or ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‹ç¢ºèª
4. åˆå›ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã•ã‚Œã‚‹ã‹ç¢ºèªï¼ˆ`spring.jpa.hibernate.ddl-auto=update`ï¼‰

---

## ğŸš¨ ã‚ˆãã‚ã‚‹æ¥ç¶šã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼å†…å®¹ | åŸå› ã¨å¯¾ç­– |
|------------|------------|
| Timeout | SG ã§ãƒãƒ¼ãƒˆ 3306 ãŒé–‹ã„ã¦ã„ãªã„ï¼VPCãŒé•ã† |
| Access Denied | ãƒ¦ãƒ¼ã‚¶ãƒ¼å or ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é–“é•ã„ |
| Unknown database | JDBC URL ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åãŒæœªä½œæˆ |

---

## ğŸ”— å‚è€ƒãƒªãƒ³ã‚¯

- [Amazon Auroraï¼ˆMySQLï¼‰å…¬å¼](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/)
- [Spring Boot + MySQL æ¥ç¶š](https://spring.io/guides/gs/accessing-data-mysql/)

